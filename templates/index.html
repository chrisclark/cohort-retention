{% extends "base.html" %}

{% block head %}
    <script type="text/javascript">
    function s3_upload(){
        var status_elem = document.getElementById("status");
        var url_elem = document.getElementById("uploaded_csv_url");
        var s3upload = new S3Upload({
            file_dom_selector: 'file',
            s3_sign_put_url: '/sign_s3/',

            onProgress: function(percent, message) {
                status_elem.innerHTML = 'Upload progress: ' + percent + '% ' + message;
            },
            onFinishS3Put: function(url) {
                status_elem.innerHTML = 'Upload completed. Uploaded to: '+ url;
                url_elem.value = url;
            },
            onError: function(status) {
                status_elem.innerHTML = 'Upload error: ' + status;
            }
        });
    };
    </script>
{% endblock %}

{% block body %}
    <h1>Upload Data</h1>

    <p>Enter the URL of your data:</p>

    <div class="grid-2 gutter-40">
        <div class="span-1">
            <fieldset>
                <legend>Settings</legend>
                <form action="{{ url_for('predict') }}" method="post">
                    <ul>
                        <li>
                            <label>URL</label>
                            <input type="text" name="csvurl" />
                        </li>
                        <li>
                            <label>...or upload a csv file<small><a href="https://raw.githubusercontent.com/chrisclark/retentionizer/master/zoo/1.csv">sample</a></small></label>
                            <input type="file" id="file" onchange="s3_upload();"/>
                            <p id="status">Please select a file</p>
                            <input type="hidden" id="uploaded_csv_url" name="uploaded_csv_url" />
                        </li>
                        <li>
                            <label>...or try a sample</label>
                            <select id="samples" name="samples">
								<option>Select sample data</option>
								<option value="https://raw.githubusercontent.com/chrisclark/retentionizer/master/zoo/1.csv">eP</option>
								<option value="https://raw.githubusercontent.com/chrisclark/retentionizer/master/zoo/2.csv">Paper</option>
								<option value="https://raw.githubusercontent.com/chrisclark/retentionizer/master/zoo/3.csv">Internet</option>
                                <option value="https://raw.githubusercontent.com/chrisclark/retentionizer/master/zoo/4.csv">Toy</option>
							</select>
                        </li>
                        <li>
                            <label>Project x periods:</label>
                            <input type="text" name="periods" value="5" />
                        </li>
                        <li>
                            <label>Discount Rate (%):</label>
                            <input type="text" name="discount" value="10" />
                        </li>
                        <li>
                            <label>Value/customer/period ($):</label>
                            <input type="text" name="value" value="25" />
                        </li>
                        <li>
                            <input type="submit">
                        </li>
                    </ul>
                </form>
            </fieldset>
        </div>
    </div>
{%  endblock %}